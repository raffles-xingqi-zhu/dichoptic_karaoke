<!DOCTYPE html>
<html>
<head>
    <title>Karaoke App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #1a1a1a;
            color: white;
            margin: 0;
        }
        
        #lyrics-display {
            font-size: 48px;
            font-weight: bold;
            margin: 50px;
            text-align: center;
            min-height: 100px;
        }
        
        #controls {
            margin: 20px;
        }
        
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
        }
        
        #time-display {
            font-size: 18px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ¤ Karaoke</h1>
    
    <div id="lyrics-display"></div>
    
    <div id="controls">
        <button id="start-btn">Start</button>
        <button id="stop-btn">Stop</button>
        <button id="reset-btn">Reset</button>
    </div>
    
    <div id="time-display">Time: 0.00s</div>

    <script>
        let lyricsData = [];
        let currentTime = 0;
        let isPlaying = false;
        let startTime = null;

        // Load all lyrics data when page loads
        async function loadLyrics() {
            try {
                const response = await fetch('/dichoptic-demo/api/lyrics');
                lyricsData = await response.json();
                console.log('Loaded lyrics:', lyricsData);
            } catch (error) {
                console.error('Error loading lyrics:', error);
            }
        }

        // Get the lyric for the current time
        function getCurrentLyric(time) {
            let currentLyric = "";
            for (let i = 0; i < lyricsData.length; i++) {
                const [lyric, timestamp] = lyricsData[i];
                if (timestamp <= time) {
                    currentLyric = lyric;
                } else {
                    break;
                }
            }
            return currentLyric;
        }

        // Update the display
        function updateDisplay() {
            const lyricDisplay = document.getElementById('lyrics-display');
            const timeDisplay = document.getElementById('time-display');

            const lyric = getCurrentLyric(currentTime);
            lyricDisplay.textContent = lyric;
            timeDisplay.textContent = `Time: ${currentTime.toFixed(2)}s`;
        }

        // Animation loop
        function animationLoop() {
            if (isPlaying) {
                currentTime = (Date.now() - startTime) / 1000;
                updateDisplay();
                requestAnimationFrame(animationLoop);
            }
        }

        // Button controls
        document.getElementById('start-btn').addEventListener('click', () => {
            if (!isPlaying) {
                isPlaying = true;
                startTime = Date.now() - (currentTime * 1000);
                animationLoop();
            }
        });

        document.getElementById('stop-btn').addEventListener('click', () => {
            isPlaying = false;
        });

        document.getElementById('reset-btn').addEventListener('click', () => {
            isPlaying = false;
            currentTime = 0;
            updateDisplay();
        });

        // Load lyrics on page load
        loadLyrics();
    </script>
</body>
</html>